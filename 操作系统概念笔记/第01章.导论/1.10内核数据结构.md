## 1.10内核数据结构

这一节简单总结。

### 1.10.4位图

这个位图不是我刚开始认为的图像格式。

这个位图其实是n个二进制的串，每一位代表相应位置编号的资源子否可用，一般0表示可用，1表示不可用，假如系统有16个资源，这16个资源是否可用就可以用16位的二进制表示：0010000000000000，表示第3个资源不可用，其他可用。磁盘就是用这种结构表示磁盘上每一个块是否可用。

* 磁盘块：磁盘存储文件的时候，通常不以扇区为单位，毕竟一个扇区容量太小，而是以块为单位。一个块包含若干个扇区。块太小，磁盘利用率高，但是数据访问太慢，想象一下，如果一个块只有一个扇区，当磁盘上的小文件很多，而且经多不断的添加删除操作，磁盘上的文件会被分割存储在一个个很小的空间碎片上，不利于提高访问效率。磁盘块设置过大，访问效率提高了，但是磁盘利用率降低了，一个只有1字节的文件，可能会占用一个124K的磁盘空间。

不仅仅磁盘存储使用inode，磁盘文件的管理也借鉴了这种思路，记得1.8提到的Linux系统在管理文件的时候，才用了inode结构吗？Linux在格式化硬盘，创建文件系统的时候，就分配好了所有的inode编号，并且借鉴位图，设计了一个叫做inodemap的数据结构，管理文件。假如最多允许30万个文件，那么就有30万个inode编号被inodemap管理，增加或者删除第i个文件，inodemap结构中第i个元素的状态机会改变。
